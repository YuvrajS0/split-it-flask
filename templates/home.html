<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Receipt Splitter</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .item-block {
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }
        .assignments-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <h2>Welcome, {{ user.username }}</h2>
    <hr>

<form action="{{ url_for('home') }}" method="POST">
    <div class="mb-3">
        <label for="receiptName" class="form-label">Receipt Name</label>
        <input type="text" class="form-control" id="receiptName" name="receipt_name" required>
    </div>
    <div class="mb-3">
        <label for="taxTip" class="form-label">Tax + Tip Total</label>
        <input type="number" step="0.01" class="form-control" id="taxTip" name="tax_tip" required>
    </div>

    <h4 class="mt-4">People Involved</h4>
    <div id="people-list" class="mb-3">
        <input type="text" class="form-control mb-2" name="people[]" placeholder="Person name" required>
    </div>
    <button type="button" class="btn btn-secondary mb-3" onclick="addPerson()">Add Person</button>

    <h4 class="mt-4">Items</h4>
    <div id="items-list">
        <div class="item-block">
            <input type="text" class="form-control mb-2" name="item_names[]" placeholder="Item name" required>
            <input type="number" step="0.01" class="form-control mb-2" name="item_prices[]" placeholder="Price" required>
            <label class="form-label">Assign to:</label>
            <select class="form-select" name="assignments[]" multiple required>
                <!-- JS will fill options with people -->
            </select>
        </div>
    </div>
    <button type="button" class="btn btn-secondary mb-3" onclick="addItem()">Add Item</button>

    <div class="text-end">
        <button type="submit" class="btn btn-success">Split</button>
    </div>
</form>

<script>
function addPerson() {
    const peopleList = document.getElementById('people-list');
    const input = document.createElement('input');
    input.type = 'text';
    input.name = 'people[]';
    input.placeholder = 'Person name';
    input.className = 'form-control mb-2';
    input.required = true;
    input.addEventListener('input', updateAssignmentOptions);
    peopleList.appendChild(input);
    updateAssignmentOptions();
}

function addItem() {
    const people = Array.from(document.querySelectorAll('input[name="people[]"]')).map(input => input.value).filter(v => v);
    const itemBlock = document.createElement('div');
    itemBlock.className = 'item-block';
    itemBlock.innerHTML = `
        <input type="text" class="form-control mb-2" name="item_names[]" placeholder="Item name" required>
        <input type="number" step="0.01" class="form-control mb-2" name="item_prices[]" placeholder="Price" required>
        <label class="form-label">Assign to:</label>
        <select class="form-select" name="assignments[]" multiple required>
            ${people.map(person => `<option value="${person}">${person}</option>`).join('')}
        </select>
    `;
    document.getElementById('items-list').appendChild(itemBlock);
}

function updateAssignmentOptions() {
    const people = Array.from(document.querySelectorAll('input[name="people[]"]')).map(input => input.value).filter(v => v);
    document.querySelectorAll('select[name="assignments[]"]').forEach(select => {
        select.innerHTML = people.map(person => `<option value="${person}">${person}</option>`).join('');
    });
}

window.addEventListener('load', () => {
    updateAssignmentOptions();
});
</script>
</body>
</html>